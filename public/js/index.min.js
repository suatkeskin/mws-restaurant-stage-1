let restaurants,neighborhoods,cuisines;let map;var markers=[];document.addEventListener('DOMContentLoaded',(event)=>{fetchNeighborhoods();fetchCuisines()});fetchNeighborhoods=()=>{DBHelper.fetchNeighborhoods((error,neighborhoods)=>{if(error){console.error(error)}else{self.neighborhoods=neighborhoods;fillNeighborhoodsHTML();var neighborhood=document.getElementById('neighborhood');var neighborhoodListBox=document.querySelector('.neighborhood-listbox');new ComboBox(neighborhood,neighborhoodListBox)}})};fillNeighborhoodsHTML=(neighborhoods=self.neighborhoods)=>{const ul=document.getElementById('neighborhoods-select');neighborhoods.forEach(neighborhood=>{const li=document.createElement('li');li.innerHTML=neighborhood;li.value=neighborhood;li.setAttribute("role","option");ul.append(li)})};fetchCuisines=()=>{DBHelper.fetchCuisines((error,cuisines)=>{if(error){console.error(error)}else{self.cuisines=cuisines;fillCuisinesHTML();var cuisine=document.getElementById('cuisine');var cuisineListBox=document.getElementById('cuisine-listbox');new ComboBox(cuisine,cuisineListBox)}})};fillCuisinesHTML=(cuisines=self.cuisines)=>{const ul=document.getElementById('cuisines-select');cuisines.forEach(cuisine=>{const li=document.createElement('li');li.innerHTML=cuisine;li.value=cuisine;li.setAttribute("role","option");ul.append(li)})};window.initMap=()=>{let loc={lat:40.722216,lng:-73.987501};self.map=new google.maps.Map(document.getElementById('map'),{zoom:12,center:loc,scrollwheel:!1});google.maps.event.addListener(self.map,"tilesloaded",function(){document.querySelectorAll('#map iframe').forEach(function(item){item.setAttribute('title','Google Maps')});document.querySelectorAll('#map *').forEach(function(item){item.setAttribute('tabindex','-1')});document.querySelectorAll('#map [rel="noopener"]').forEach(function(item){item.removeAttribute("rel")})});updateRestaurants()};updateRestaurants=()=>{const cuisine=document.getElementById('cuisine');const neighborhood=document.getElementById('neighborhood');DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine.value,neighborhood.value,(error,restaurants)=>{if(error){console.error(error)}else{resetRestaurants(restaurants);fillRestaurantsHTML()}})};resetRestaurants=(restaurants)=>{self.restaurants=[];const ul=document.getElementById('restaurants-list');ul.innerHTML='';self.markers.forEach(m=>m.setMap(null));self.markers=[];self.restaurants=restaurants};fillRestaurantsHTML=(restaurants=self.restaurants)=>{const ul=document.getElementById('restaurants-list');restaurants.forEach(restaurant=>{ul.append(createRestaurantHTML(restaurant))});addMarkersToMap()};createRestaurantHTML=(restaurant)=>{const li=document.createElement('li');const imgSrc=DBHelper.imageUrlForRestaurant(restaurant);if(imgSrc){const picture=document.createElement('picture');const webp=document.createElement('source');webp.type="image/webp";webp.srcset=DBHelper.webpSrcsetForRestaurant(restaurant);const img=document.createElement('source');img.type="image/jpeg";img.srcset=DBHelper.imageSrcsetForRestaurant(restaurant);const image=document.createElement('img');image.className='restaurant-img';image.src=imgSrc;image.srcset=DBHelper.imageSrcsetForRestaurant(restaurant);image.sizes="100vw";image.alt=`Image of restaurant ${restaurant.name}`;picture.appendChild(webp);picture.appendChild(img);picture.appendChild(image);li.append(picture)}
    const name=document.createElement('h3');name.innerHTML=restaurant.name;li.append(name);const neighborhood=document.createElement('p');neighborhood.innerHTML=restaurant.neighborhood;li.append(neighborhood);const address=document.createElement('p');address.innerHTML=restaurant.address;li.append(address);const more=document.createElement('a');more.innerHTML='View Details';more.href=DBHelper.urlForRestaurant(restaurant);li.append(more);return li};addMarkersToMap=(restaurants=self.restaurants)=>{restaurants.forEach(restaurant=>{const marker=DBHelper.mapMarkerForRestaurant(restaurant,self.map);google.maps.event.addListener(marker,'click',()=>{window.location.href=marker.url});self.markers.push(marker)})}
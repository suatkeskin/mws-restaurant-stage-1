"use strict";var _createClass=function(){function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var dbPromise=void 0;document.addEventListener("DOMContentLoaded",function(){dbPromise=openIndexedDB()});var openIndexedDB=function(){return"serviceWorker"in navigator?idb.open("restaurants-db",1,function(e){e.createObjectStore("restaurants",{keyPath:"id"}).createIndex("by-id","id")}):Promise.resolve()},DBHelper=function(){function u(){_classCallCheck(this,u)}return _createClass(u,null,[{key:"REMOTE_SERVER_URL",value:function(e){var n="http://localhost:1337/restaurants";return e&&(n+="/"+e),n}},{key:"fetchRestaurants",value:function(n,t){fetch(u.REMOTE_SERVER_URL(n)).then(function(e){return 200===e.status?e.json():null}).then(function(e){return e?u.saveRestaurantsToIndexedDB(e):u.loadRestaurantsFromIndexedDB(n)}).catch(function(e){return console.error("Can not fetch restaurants from remote server, will load from database!"),console.error(e),u.loadRestaurantsFromIndexedDB(n)}).then(function(e){return t(null,e)})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,a,o){u.fetchRestaurants(null,function(e,n){if(e)o(e,null);else{var t=n;"All Cuisines"!==r&&(t=t.filter(function(e){return e.cuisine_type===r})),"All Neighborhoods"!==a&&(t=t.filter(function(e){return e.neighborhood===a})),o(null,t)}})}},{key:"fetchNeighborhoods",value:function(a){u.fetchRestaurants(null,function(e,t){if(e)a(e,null);else if(t){var r=t.map(function(e,n){return t[n].neighborhood}),n=r.filter(function(e,n){return r.indexOf(e)===n});a(null,n)}else a("No restaurants available",null)})}},{key:"fetchCuisines",value:function(a){u.fetchRestaurants(null,function(e,t){if(e)a(e,null);else{var r=t.map(function(e,n){return t[n].cuisine_type}),n=r.filter(function(e,n){return r.indexOf(e)===n});a(null,n)}})}},{key:"loadRestaurantsFromIndexedDB",value:function(r){return dbPromise.then(function(e){var n=e.transaction("restaurants").objectStore("restaurants"),t=n.index("by-id");return r?n.get(Number(r)):t.getAll()}).then(function(e){return e})}},{key:"saveRestaurantsToIndexedDB",value:function(r){return dbPromise.then(function(e){if(r){var n=e.transaction("restaurants","readwrite"),t=n.objectStore("restaurants");return r instanceof Array?r.forEach(function(e){t.put(e)}):t.put(r),n.complete}}).then(function(){return r})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"webpSrcsetForRestaurant",value:function(e){return"public/img/webp/1024w/"+e.photograph+".webp 1024w, public/img/webp/640w/"+e.photograph+".webp 640w, public/img/webp/320w/"+e.photograph+".webp 320w"}},{key:"imageSrcsetForRestaurant",value:function(e){return"public/img/jpg/1024w/"+e.photograph+".jpg 1024w, public/img/jpg/640w/"+e.photograph+".jpg 640w, public/img/jpg/320w/"+e.photograph+".jpg 320w"}},{key:"imageUrlForRestaurant",value:function(e){if(e.photograph)return"public/img/jpg/320w/"+e.photograph+".jpg"}},{key:"mapMarkerForRestaurant",value:function(e,n){return new google.maps.Marker({position:e.latlng,title:e.name,url:u.urlForRestaurant(e),map:n,animation:google.maps.Animation.DROP})}}]),u}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIl0sIm5hbWVzIjpbImRiUHJvbWlzZSIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9wZW5JbmRleGVkREIiLCJuYXZpZ2F0b3IiLCJpZGIiLCJvcGVuIiwidXBncmFkZURiIiwia2V5UGF0aCIsImNyZWF0ZUluZGV4IiwiUHJvbWlzZSIsInJlc29sdmUiLCJEQkhlbHBlciIsInBhcmFtZXRlciIsInVybCIsImlkIiwiY2FsbGJhY2siLCJmZXRjaCIsIlJFTU9URV9TRVJWRVJfVVJMIiwidGhlbiIsInBvcnQiLCJyZXNwb25zZSIsInN0YXR1cyIsImpzb24iLCJzYXZlUmVzdGF1cmFudHNUb0luZGV4ZWREQiIsInJlc3RhdXJhbnRzIiwibG9hZFJlc3RhdXJhbnRzRnJvbUluZGV4ZWREQiIsImNhdGNoIiwiY29uc29sZSIsImVycm9yIiwiY3Vpc2luZSIsIm5laWdoYm9yaG9vZCIsImZldGNoUmVzdGF1cmFudHMiLCJyZXN1bHRzIiwiciIsImN1aXNpbmVfdHlwZSIsIm1hcCIsInYiLCJpIiwidW5pcXVlTmVpZ2hib3Job29kcyIsIm5laWdoYm9yaG9vZHMiLCJmaWx0ZXIiLCJpbmRleE9mIiwiY3Vpc2luZXMiLCJ1bmlxdWVDdWlzaW5lcyIsInJlc3RhdXJhbnRzU3RvcmUiLCJkYiIsInRyYW5zYWN0aW9uIiwib2JqZWN0U3RvcmUiLCJpZEluZGV4IiwiZ2V0QWxsIiwidHgiLCJBcnJheSIsImZvckVhY2giLCJyZXN0YXVyYW50IiwicHV0IiwiY29tcGxldGUiLCJwaG90b2dyYXBoIiwiZ2V0IiwidXJsRm9yUmVzdGF1cmFudCIsIkFuaW1hdGlvbiJdLCJtYXBwaW5ncyI6IjZYQUdBLElBQUlBLGVBQUFBLEVBQ0pDLFNBQVNDLGlCQUFpQixtQkFBb0IsV0FDN0NGLFVBQVlHLGtCQUNaLElBRkRBLGNBQUEsV0FJQSxNQUFBLGtCQUFBQyxVQVNRQyxJQUFJQyxLQUFLLGlCQUFrQixFQUFHLFNBQVVDLEdBTDVCQSxFQUFoQkos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MERBTUZILEdBK0NDLEdBQUtBLEVBQVdHLFdBR2hCLE1BQUEsdUJBQThCSCxFQUFXRyxXQUF6QyxzREEzQzhCVCxFQUFZWixHQUN4QyxPQUFJWCxJQUFBQSxPQUFBQSxLQUFBQSxPQUF1QjJCLENBQzFCM0IsU0FBQUEsRUFBWTRCLE9BQ1hSLE1BQUFBLEVBQUFBLEtBQ0EvQixJQUZERixFQUFBK0MsaUJBQUFMLEdBR0FsQixJQUpEQSxFQUtDUyxVQUFBQSxPQUFBQSxLQUFBZSxVQUFxQm5DIiwiZmlsZSI6ImRiaGVscGVyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlIGFuIGluZGV4ZWREQiBwcm9taXNlXG4gKi9cbmxldCBkYlByb21pc2U7XG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4ge1xuXHRkYlByb21pc2UgPSBvcGVuSW5kZXhlZERCKCk7XG59KTtcblxuLyoqXG4gKiBDcmVhdGUgYW4gaW5kZXhlZERCIHRoYXQgY29udGFpbnMgb25lIG9iamVjdFN0b3JlOiAncmVzdGF1cmFudHMnIHRoYXQgdXNlcyAnaWQnIGFzIGl0cyBrZXkgYW5kIGhhcyBhbiBpbmRleCBjYWxsZWQgJ2J5LWlkJywgd2hpY2ggaXMgc29ydGVkIGJ5IHRoZSAnaWQnIHByb3BlcnR5XG4gKiBAcmV0dXJucyBhIHByb21pc2UgZm9yIGEgZGF0YWJhc2UgY2FsbGVkICdyZXN0YXVyYW50cydcbiAqL1xubGV0IG9wZW5JbmRleGVkREIgPSAoKSA9PiB7XG5cdC8vIElmIHRoZSBicm93c2VyIGRvZXNuJ3Qgc3VwcG9ydCBzZXJ2aWNlIHdvcmtlciwgd2UgZG9uJ3QgY2FyZSBhYm91dCBoYXZpbmcgYSBkYXRhYmFzZVxuXHRpZiAoISgnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yKSkge1xuXHRcdHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcblx0fVxuXHRyZXR1cm4gaWRiLm9wZW4oJ3Jlc3RhdXJhbnRzLWRiJywgMSwgZnVuY3Rpb24gKHVwZ3JhZGVEYikge1xuXHRcdGxldCByZXN0YXVyYW50c1N0b3JlID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycsIHtrZXlQYXRoOiAnaWQnfSk7XG5cdFx0cmVzdGF1cmFudHNTdG9yZS5jcmVhdGVJbmRleCgnYnktaWQnLCAnaWQnKTtcblx0fSk7XG59O1xuXG4vKipcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxuICovXG5jbGFzcyBEQkhlbHBlciB7XG5cdC8qKlxuXHQgKiBEYXRhYmFzZSBVUkwuXG5cdCAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cblx0ICovXG5cdHN0YXRpYyBSRU1PVEVfU0VSVkVSX1VSTChwYXJhbWV0ZXIpIHtcblx0XHRjb25zdCBwb3J0ID0gMTMzNztcblx0XHRsZXQgdXJsID0gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXN0YXVyYW50c2A7XG5cdFx0aWYgKHBhcmFtZXRlcikge1xuXHRcdFx0dXJsICs9IGAvJHtwYXJhbWV0ZXJ9YDtcblx0XHR9XG5cdFx0cmV0dXJuIHVybDtcblx0fVxuXG5cdC8qKlxuXHQgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMgZnJvbSByZW1vdGUgc2VydmVyLlxuXHQgKiBMb2FkIGFsbCByZXN0YXVyYW50cyBmcm9tIHJlbW90ZSBzZXJ2ZXIsIGlmIGZhaWxzIGxvYWQgZnJvbSBpbmRleGVkIERCXG5cdCAqL1xuXHRzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cyhpZCwgY2FsbGJhY2spIHtcblx0XHRmZXRjaChEQkhlbHBlci5SRU1PVEVfU0VSVkVSX1VSTChpZCkpXG5cdFx0XHQudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5zdGF0dXMgPT09IDIwMCA/IHJlc3BvbnNlLmpzb24oKSA6IG51bGwpXG5cdFx0XHQudGhlbihyZXN0YXVyYW50cyA9PiByZXN0YXVyYW50cyA/IERCSGVscGVyLnNhdmVSZXN0YXVyYW50c1RvSW5kZXhlZERCKHJlc3RhdXJhbnRzKSA6IERCSGVscGVyLmxvYWRSZXN0YXVyYW50c0Zyb21JbmRleGVkREIoaWQpKVxuXHRcdFx0LmNhdGNoKChlcnJvcikgPT4ge1xuXHRcdFx0XHRjb25zb2xlLmVycm9yKCdDYW4gbm90IGZldGNoIHJlc3RhdXJhbnRzIGZyb20gcmVtb3RlIHNlcnZlciwgd2lsbCBsb2FkIGZyb20gZGF0YWJhc2UhJyk7XG5cdFx0XHRcdGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuXHRcdFx0XHRyZXR1cm4gREJIZWxwZXIubG9hZFJlc3RhdXJhbnRzRnJvbUluZGV4ZWREQihpZCk7XG5cdFx0XHR9KS50aGVuKChyZXN0YXVyYW50cykgPT4gY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuXHQgKi9cblx0c3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XG5cdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG5cdFx0REJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cyhudWxsLCAoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0bGV0IHJlc3VsdHMgPSByZXN0YXVyYW50cztcblx0XHRcdFx0aWYgKGN1aXNpbmUgIT09ICdBbGwgQ3Vpc2luZXMnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXG5cdFx0XHRcdFx0cmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT09IGN1aXNpbmUpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmIChuZWlnaGJvcmhvb2QgIT09ICdBbGwgTmVpZ2hib3Job29kcycpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxuXHRcdFx0XHRcdHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09PSBuZWlnaGJvcmhvb2QpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG5cdCAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuXHQgKi9cblx0c3RhdGljIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xuXHRcdC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuXHRcdERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMobnVsbCwgKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuXHRcdFx0aWYgKGVycm9yKSB7XG5cdFx0XHRcdGNhbGxiYWNrKGVycm9yLCBudWxsKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmIChyZXN0YXVyYW50cykge1xuXHRcdFx0XHRcdC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuXHRcdFx0XHRcdGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZCk7XG5cdFx0XHRcdFx0Ly8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXG5cdFx0XHRcdFx0Y29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT09IGkpO1xuXHRcdFx0XHRcdGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNhbGxiYWNrKCdObyByZXN0YXVyYW50cyBhdmFpbGFibGUnLCBudWxsKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG5cdCAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cblx0ICovXG5cdHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XG5cdFx0Ly8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG5cdFx0REJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cyhudWxsLCAoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG5cdFx0XHRpZiAoZXJyb3IpIHtcblx0XHRcdFx0Y2FsbGJhY2soZXJyb3IsIG51bGwpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuXHRcdFx0XHRjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKTtcblx0XHRcdFx0Ly8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xuXHRcdFx0XHRjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PT0gaSk7XG5cdFx0XHRcdGNhbGxiYWNrKG51bGwsIHVuaXF1ZUN1aXNpbmVzKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBMb2FkIHJlc3RhdXJhbnRzIGZyb20gaW5kZXhlZCBEQi5cblx0ICovXG5cdHN0YXRpYyBsb2FkUmVzdGF1cmFudHNGcm9tSW5kZXhlZERCKGlkKSB7XG5cdFx0cmV0dXJuIGRiUHJvbWlzZS50aGVuKGZ1bmN0aW9uIChkYikge1xuXHRcdFx0Y29uc3QgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnKTtcblx0XHRcdGNvbnN0IHJlc3RhdXJhbnRzU3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKTtcblx0XHRcdGNvbnN0IGlkSW5kZXggPSByZXN0YXVyYW50c1N0b3JlLmluZGV4KCdieS1pZCcpO1xuXHRcdFx0cmV0dXJuIGlkID8gcmVzdGF1cmFudHNTdG9yZS5nZXQoTnVtYmVyKGlkKSkgOiBpZEluZGV4LmdldEFsbCgpO1xuXHRcdH0pLnRoZW4oZnVuY3Rpb24gKHJlc3RhdXJhbnRzKSB7XG5cdFx0XHRyZXR1cm4gcmVzdGF1cmFudHM7XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0ICogU2F2ZSByZXN0YXVyYW50cyB0byBpbmRleGVkIERCLlxuXHQgKi9cblx0c3RhdGljIHNhdmVSZXN0YXVyYW50c1RvSW5kZXhlZERCKHJlc3RhdXJhbnRzKSB7XG5cdFx0cmV0dXJuIGRiUHJvbWlzZS50aGVuKGZ1bmN0aW9uIChkYikge1xuXHRcdFx0aWYgKHJlc3RhdXJhbnRzKSB7XG5cdFx0XHRcdGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpO1xuXHRcdFx0XHRjb25zdCByZXN0YXVyYW50c1N0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XG5cdFx0XHRcdGlmIChyZXN0YXVyYW50cyBpbnN0YW5jZW9mIEFycmF5KSB7XG5cdFx0XHRcdFx0cmVzdGF1cmFudHMuZm9yRWFjaChmdW5jdGlvbiAocmVzdGF1cmFudCkge1xuXHRcdFx0XHRcdFx0cmVzdGF1cmFudHNTdG9yZS5wdXQocmVzdGF1cmFudCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cmVzdGF1cmFudHNTdG9yZS5wdXQocmVzdGF1cmFudHMpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiB0eC5jb21wbGV0ZTtcblx0XHRcdH1cblx0XHR9KS50aGVuKGZ1bmN0aW9uICgpIHtcblx0XHRcdHJldHVybiByZXN0YXVyYW50cztcblx0XHR9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxuXHQgKi9cblx0c3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuXHRcdHJldHVybiAoYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZXN0YXVyYW50IGltYWdlIHNyY3NldC5cblx0ICovXG5cdHN0YXRpYyB3ZWJwU3Jjc2V0Rm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG5cdFx0cmV0dXJuIGBwdWJsaWMvaW1nL3dlYnAvMTAyNHcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9LndlYnAgMTAyNHcsIHB1YmxpYy9pbWcvd2VicC82NDB3LyR7cmVzdGF1cmFudC5waG90b2dyYXBofS53ZWJwIDY0MHcsIHB1YmxpYy9pbWcvd2VicC8zMjB3LyR7cmVzdGF1cmFudC5waG90b2dyYXBofS53ZWJwIDMyMHdgO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJlc3RhdXJhbnQgaW1hZ2Ugc3Jjc2V0LlxuXHQgKi9cblx0c3RhdGljIGltYWdlU3Jjc2V0Rm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG5cdFx0cmV0dXJuIGBwdWJsaWMvaW1nL2pwZy8xMDI0dy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaH0uanBnIDEwMjR3LCBwdWJsaWMvaW1nL2pwZy82NDB3LyR7cmVzdGF1cmFudC5waG90b2dyYXBofS5qcGcgNjQwdywgcHVibGljL2ltZy9qcGcvMzIwdy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaH0uanBnIDMyMHdgO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxuXHQgKi9cblx0c3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG5cdFx0aWYgKCFyZXN0YXVyYW50LnBob3RvZ3JhcGgpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0cmV0dXJuIGBwdWJsaWMvaW1nL2pwZy8zMjB3LyR7cmVzdGF1cmFudC5waG90b2dyYXBofS5qcGdgO1xuXHR9XG5cblx0LyoqXG5cdCAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cblx0ICovXG5cdHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xuXHRcdHJldHVybiBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcblx0XHRcdHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcblx0XHRcdHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXG5cdFx0XHR1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXG5cdFx0XHRtYXA6IG1hcCxcblx0XHRcdGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1Bcblx0XHR9KTtcblx0fVxufVxuIl19

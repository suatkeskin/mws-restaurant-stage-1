"use strict";var VK_ENTER=13,VK_ESC=27,VK_UP=38,VK_DOWN=40,LAST_ID=0;function nextId(){var t=":"+LAST_ID;return LAST_ID++,t}function ComboBox(t,e){this.el=t,this.listbox=new ListBox(e,this),e.id=nextId(),this.el.addEventListener("focus",this.handleFocus.bind(this),!0),this.el.addEventListener("blur",this.handleBlur.bind(this),!0),this.el.addEventListener("input",this.handleInput.bind(this)),this.el.addEventListener("keydown",this.handleKeyDown.bind(this))}function ListBox(t,e){this.el=t,this.textbox=e,this.items=Array.prototype.slice.call(t.querySelectorAll("[role=option]"));for(var i=0;i<this.items.length;i++){var s=this.items[i];s.id=nextId(),s.addEventListener("mouseover",this.handleHoverOnItem.bind(this)),s.addEventListener("mousedown",this.handleClickOnItem.bind(this),!0)}this.visibleItems=this.items.slice()}ComboBox.prototype={set value(t){this.el.value=t},showListbox:function(t){this.listbox.show(t),this.el.setAttribute("aria-expanded",!0)},hideListbox:function(){this.listbox.hide(),this.el.setAttribute("aria-expanded",!1),this.el.removeAttribute("aria-activedescendant")},handleFocus:function(t){this.showListbox(t.target)},handleBlur:function(){this.hideListbox()},handleInput:function(t){this.showListbox(t.target),this.listbox.filter(this.el.value)},handleKeyDown:function(t){if(VK_DOWN===t.keyCode)this.listbox.hidden||this.listbox.nextActiveListItem();else if(VK_UP===t.keyCode)this.listbox.hidden||this.listbox.previousActiveListItem();else if(VK_ENTER===t.keyCode){var e=this.listbox.activeItem;e&&(this.setSelected(e),this.hideListbox())}else VK_ESC===t.keyCode&&this.hideListbox()},setSelected:function(t){this.value=t.textContent,updateRestaurants()},setActiveDescendant:function(t){t.id&&this.el.setAttribute("aria-activedescendant",t.id)}},ListBox.prototype={toggle:function(){this.hidden?this.show():this.hide()},get hidden(){return this.el.hasAttribute("hidden")},get activeItem(){return this.el.querySelector("[role=option].active")},filter:function(t){var e=0,i=!0,s=!(this.visibleItems=[]),n=void 0;try{for(var h,o=this.items[Symbol.iterator]();!(i=(h=o.next()).done);i=!0){var a=h.value;a.textContent.toLowerCase().startsWith(t.toLowerCase())?(e++,a.hidden=!1,this.visibleItems.push(a)):(a.hidden=!0,a.classList.remove("active"))}}catch(t){s=!0,n=t}finally{try{!i&&o.return&&o.return()}finally{if(s)throw n}}if(0===e)this.hide();else for(var d=0;d<this.visibleItems.length;d++){var l=this.visibleItems[d];l.setAttribute("aria-posinset",d+1),l.setAttribute("aria-setsize",this.visibleItems.length)}},show:function(t){this.hidden&&(this.el.style.width=t.offsetWidth+"px",this.el.style.left=t.offsetLeft+"px",this.el.removeAttribute("hidden"))},hide:function(){this.hidden||(this.activeItem&&this.activeItem.classList.remove("active"),this.el.setAttribute("hidden",""))},handleHoverOnItem:function(t){var e=this.visibleItems.indexOf(t.target);e<0||this.changeActiveListitem(e)},handleClickOnItem:function(t){var e=t.target;this.items.indexOf(e)<0||(this.textbox.setSelected(e),this.hide())},nextActiveListItem:function(){var t=this.activeItem,e=-1;t&&(e=this.visibleItems.indexOf(t));var i=e;i=(i+1)%this.visibleItems.length,this.changeActiveListitem(i)},previousActiveListItem:function(){var t=this.activeItem,e=-1;t&&(e=this.visibleItems.indexOf(t));var i=e;--i<0&&(i+=this.visibleItems.length),this.changeActiveListitem(i)},changeActiveListitem:function(t){var e=this.activeItem,i=this.visibleItems[t];e&&e.classList.remove("active"),i.classList.add("active"),this.textbox.setActiveDescendant(i)}};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbWJvYm94LmpzIl0sIm5hbWVzIjpbIlZLX0VOVEVSIiwiVktfRVNDIiwiVktfVVAiLCJMQVNUX0lEIiwibmV4dElkIiwiaWQiLCJDb21ib0JveCIsImVsIiwibGlzdEVsIiwidGhpcyIsIkxpc3RCb3giLCJsaXN0Ym94IiwiYWRkRXZlbnRMaXN0ZW5lciIsImhhbmRsZUZvY3VzIiwiYmluZCIsImhhbmRsZUJsdXIiLCJoYW5kbGVJbnB1dCIsInRleHRib3giLCJBcnJheSIsInNsaWNlIiwiY2FsbCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpdGVtcyIsInByb3RvdHlwZSIsImkiLCJpdGVtIiwiaGFuZGxlSG92ZXJPbkl0ZW0iLCJ2aXNpYmxlSXRlbXMiLCJ2YWx1ZSIsInZhbCIsInNob3dMaXN0Ym94IiwidGFyZ2V0Iiwic2hvdyIsImhpZGVMaXN0Ym94IiwiaGlkZSIsInNldEF0dHJpYnV0ZSIsImUiLCJoYW5kbGVLZXlEb3duIiwia2V5Q29kZSIsIlZLX0RPV04iLCJhY3RpdmUiLCJzZXRTZWxlY3RlZCIsInRleHRDb250ZW50IiwidXBkYXRlUmVzdGF1cmFudHMiLCJzZXRBY3RpdmVEZXNjZW5kYW50IiwidG9nZ2xlIiwiaGlkZGVuIiwiaGFzQXR0cmlidXRlIiwiYWN0aXZlSXRlbSIsInF1ZXJ5U2VsZWN0b3IiLCJmaWx0ZXIiLCJzdHIiLCJmb3VuZEl0ZW1zIiwiX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiIsIl9kaWRJdGVyYXRvckVycm9yIiwiX2l0ZXJhdG9yRXJyb3IiLCJ1bmRlZmluZWQiLCJfc3RlcCIsIl9pdGVyYXRvciIsIlN5bWJvbCIsIml0ZXJhdG9yIiwibmV4dCIsImRvbmUiLCJ0b0xvd2VyQ2FzZSIsInN0YXJ0c1dpdGgiLCJwdXNoIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiZXJyIiwicmV0dXJuIiwibGVuZ3RoIiwic3R5bGUiLCJ3aWR0aCIsIm9mZnNldFdpZHRoIiwibGVmdCIsIm9mZnNldExlZnQiLCJyZW1vdmVBdHRyaWJ1dGUiLCJuZXdJZHgiLCJpbmRleE9mIiwiY2hhbmdlQWN0aXZlTGlzdGl0ZW0iLCJoYW5kbGVDbGlja09uSXRlbSIsIm5leHRBY3RpdmVMaXN0SXRlbSIsImFjdGl2ZUlkeCIsInByZXZpb3VzQWN0aXZlTGlzdEl0ZW0iLCJuZXdBY3RpdmUiXSwibWFwcGluZ3MiOiJBQUFBLGFBR0EsSUFBTUEsU0FBVyxHQUFYQSxPQUFXLEdBQ1hDLE1BQVMsR0FDVEMsUUFBTixHQUdJQyxRQUFVLEVBTWQsU0FBU0MsU0FBVCxJQUFBQyxFQUFTRCxJQUFURCxRQUVDQSxPQURBQSxVQUNBQSxFQWFELFNBQVNHLFNBQVNDLEVBQUlDLEdBQXRCQyxLQUFBRixHQUFTRCxFQUNSRyxLQUFLRixRQUFMLElBQUFHLFFBQUFGLEVBQUFDLE1BQ0FELEVBQUtHLEdBQUxQLFNBR0FLLEtBQUtGLEdBQUdLLGlCQUFpQixRQUFTSCxLQUFLSSxZQUFZQyxLQUFLTCxPQUFPLEdBQS9EQSxLQUFLRixHQUFHSyxpQkFBaUIsT0FBekJILEtBQWtDTSxXQUFLRixLQUFZQyxPQUFuRCxHQUNBTCxLQUFLRixHQUFHSyxpQkFBaUIsUUFBUUgsS0FBS00sWUFBV0QsS0FBS0wsT0FDdERBLEtBQUtGLEdBQUdLLGlCQUFpQixVQUFTSCxLQUFLTyxjQUFMRixLQUFBTCxPQTJFbkMsU0FBU0MsUUFBUUgsRUFBSVUsR0FBckJSLEtBQUFGLEdBQVNHLEVBQ1JELEtBQUtGLFFBQUxVLEVBQ0FSLEtBQUtRLE1BQUxDLE1BQWVELFVBQWZFLE1BQUFDLEtBQUFiLEVBQUFjLGlCQUFBLGtCQUNBLElBQUtDLElBQUFBLEVBQVFKLEVBQUFBLEVBQU1LLEtBQUFBLE1BQVVKLE9BQWhCSyxJQUE4QkgsQ0FDM0MsSUFBS0ksRUFBSUQsS0FBT0EsTUFBSUEsR0FDbkJDLEVBQUlBLEdBQUFBLFNBR0pBLEVBQUtiLGlCQUFpQixZQUFhSCxLQUFLaUIsa0JBQWtCWixLQUFLTCxPQUEvRGdCLEVBQUtiLGlCQUFpQixZQUFhSCxLQUFLaUIsa0JBQWtCWixLQUFLTCxPQUEvRCxH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QixLQUFBdUMsV0FFT2tCLFVBQUFDLE9BQUEsVUFDTjFELEtBQUFGLEdBQUs0QixhQUFlLFNBQUtSLE1BR3hCRixrQkFBS1UsU0FBYUMsR0FDbEIsSUFBQXlDLEVBQUFwRSxLQUFBa0IsYUFBQW1ELFFBQUExQyxFQUFBTCxRQUNEOEMsRUFBQSxHQXdCRHBFLEtBQUtzRSxxQkFBcUJGLElBbEIxQkcsa0JBQWNSLFNBQVd6QyxHQUN6QixJQUFBTixFQUFROEMsRUFBUnhDLE9BQ0F0QixLQUFRbUUsTUFBQUEsUUFBUm5ELEdBQXdCLElBdUJ4QmhCLEtBQUtRLFFBQVF3QixZQUFZaEIsR0FwQjFCUyxLQUFNQSxTQUlMK0MsbUJBQUEsV0FFQSxJQUFBekMsRUFBUUwsS0FBQUEsV0F2RFUrQyxHQUFBLEVBNEVkMUMsSUFsQkxkLEVBQUFBLEtBQW1CQyxhQUFBbUQsUUFBQXRDLElBRWxCLElBQUlxQyxFQUFTSyxFQUViTCxHQUFLRSxFQUFBQSxHQUFBQSxLQUFxQkYsYUFBMUJQLE9BOURrQjdELEtBQUFzRSxxQkFBQUYsSUFrRWxCTSx1QkFBQSxXQUNBLElBQUkzQyxFQUFLbEIsS0FBTXdELFdBRWZJLEdBQWF6QyxFQUNiRCxJQXRFa0IwQyxFQUFBekUsS0FBQWtCLGFBQUFtRCxRQUFBdEMsSUF5RW5CeUMsSUFBQUEsRUFBQUEsSUFDQ0osRUFDSUssSUFDSkwsR0FBQXBFLEtBQ0N5RSxhQUFpQnZELFFBRWxCbEIsS0FBSW9FLHFCQUFKQSxJQUdBRSxxQkFsRmtCLFNBQUFGLEdBbUdsQixJQUFJckMsRUFBUy9CLEtBQUt1QyxXQWZuQm1DLEVBQUFBLEtBQUFBLGFBQXdCTixHQUNuQnJDLEdBQ0pBLEVBQUkwQyxVQUFKZixPQUFBLFVBQ0FpQixFQUFBbEIsVUFDQ2dCLElBQVksVUFFYnpFLEtBQUlvRSxRQUFTSyxvQkFBYkUiLCJmaWxlIjoiY29tYm9ib3gubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG4vLyBEZWZpbmUgdmFsdWVzIGZvciBrZXkgY29kZXNcbmNvbnN0IFZLX0VOVEVSID0gMTM7XG5jb25zdCBWS19FU0MgPSAyNztcbmNvbnN0IFZLX1VQID0gMzg7XG5jb25zdCBWS19ET1dOID0gNDA7XG5cbmxldCBMQVNUX0lEID0gMDtcblxuLyoqXG4gKiBHZW5lcmF0ZSBhIHVuaXF1ZSBET00gSUQuXG4gKiBAcmV0dXJuIHtzdHJpbmd9XG4gKi9cbmZ1bmN0aW9uIG5leHRJZCgpIHtcblx0bGV0IGlkID0gJzonICsgTEFTVF9JRDtcblx0TEFTVF9JRCsrO1xuXHRyZXR1cm4gaWQ7XG59XG5cbi8qKlxuICogQGNvbnN0cnVjdG9yXG4gKiBJbXBsZW1lbnRzIGEgbWluaW1hbCBjb21ibyBib3g6IGEgdGV4dCBmaWVsZCB3aXRoIGEgbGlzdCBvZiBvcHRpb25zIHdoaWNoIHBvcHMgdXAgd2hlbiB0aGUgdGV4dFxuICogZmllbGQgaXMgZm9jdXNlZC5cbiAqIFVzZSBhcnJvdyBrZXlzIG9yIG1vdXNlIHRvIGNob29zZSBmcm9tIGF2YWlsYWJsZSBvcHRpb25zLlxuICogQHBhcmFtIHtFbGVtZW50fSBlbCBUaGUgdGV4dCBmaWVsZCBlbGVtZW50IHRvIGRlY29yYXRlLlxuICogQHBhcmFtIHtFbGVtZW50fSBsaXN0RWwgVGhlIGxpc3Rib3ggZWxlbWVudCB0byBhc3NvY2lhdGUgd2l0aCB0aGlzIHRleHQgZmllbGQ7IGFsc28gZGVjb3JhdGVzXG4gKiAgICAgaXQgd2l0aCB0aGUgYExpc3RCb3hgIHBhdHRlcm4uXG4gKi9cbmZ1bmN0aW9uIENvbWJvQm94KGVsLCBsaXN0RWwpIHtcblx0dGhpcy5lbCA9IGVsO1xuXHR0aGlzLmxpc3Rib3ggPSBuZXcgTGlzdEJveChsaXN0RWwsIHRoaXMpO1xuXHRsaXN0RWwuaWQgPSBuZXh0SWQoKTtcblxuXHR0aGlzLmVsLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5oYW5kbGVGb2N1cy5iaW5kKHRoaXMpLCB0cnVlKTtcblx0dGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgdGhpcy5oYW5kbGVCbHVyLmJpbmQodGhpcyksIHRydWUpO1xuXHR0aGlzLmVsLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgdGhpcy5oYW5kbGVJbnB1dC5iaW5kKHRoaXMpKTtcblx0dGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5oYW5kbGVLZXlEb3duLmJpbmQodGhpcykpO1xufVxuXG5Db21ib0JveC5wcm90b3R5cGUgPSB7XG5cdHNldCB2YWx1ZSh2YWwpIHtcblx0XHR0aGlzLmVsLnZhbHVlID0gdmFsO1xuXHR9LFxuXG5cdHNob3dMaXN0Ym94OiBmdW5jdGlvbiAodGFyZ2V0KSB7XG5cdFx0dGhpcy5saXN0Ym94LnNob3codGFyZ2V0KTtcblx0XHR0aGlzLmVsLnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsIHRydWUpO1xuXHR9LFxuXG5cdGhpZGVMaXN0Ym94OiBmdW5jdGlvbiAoKSB7XG5cdFx0dGhpcy5saXN0Ym94LmhpZGUoKTtcblx0XHR0aGlzLmVsLnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsIGZhbHNlKTtcblx0XHR0aGlzLmVsLnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1hY3RpdmVkZXNjZW5kYW50Jyk7XG5cdH0sXG5cblx0aGFuZGxlRm9jdXM6IGZ1bmN0aW9uIChlKSB7XG5cdFx0dGhpcy5zaG93TGlzdGJveChlLnRhcmdldCk7XG5cdH0sXG5cblx0aGFuZGxlQmx1cjogZnVuY3Rpb24gKCkge1xuXHRcdHRoaXMuaGlkZUxpc3Rib3goKTtcblx0fSxcblxuXHRoYW5kbGVJbnB1dDogZnVuY3Rpb24gKGUpIHtcblx0XHR0aGlzLnNob3dMaXN0Ym94KGUudGFyZ2V0KTtcblx0XHR0aGlzLmxpc3Rib3guZmlsdGVyKHRoaXMuZWwudmFsdWUpO1xuXHR9LFxuXG5cdGhhbmRsZUtleURvd246IGZ1bmN0aW9uIChlKSB7XG5cdFx0aWYgKFZLX0RPV04gPT09IGUua2V5Q29kZSkge1xuXHRcdFx0aWYgKCF0aGlzLmxpc3Rib3guaGlkZGVuKSB7XG5cdFx0XHRcdHRoaXMubGlzdGJveC5uZXh0QWN0aXZlTGlzdEl0ZW0oKTtcblx0XHRcdH1cblx0XHR9IGVsc2UgaWYgKFZLX1VQID09PSBlLmtleUNvZGUpIHtcblx0XHRcdGlmICghdGhpcy5saXN0Ym94LmhpZGRlbikge1xuXHRcdFx0XHR0aGlzLmxpc3Rib3gucHJldmlvdXNBY3RpdmVMaXN0SXRlbSgpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSBpZiAoVktfRU5URVIgPT09IGUua2V5Q29kZSkge1xuXHRcdFx0bGV0IGFjdGl2ZSA9IHRoaXMubGlzdGJveC5hY3RpdmVJdGVtO1xuXHRcdFx0aWYgKGFjdGl2ZSkge1xuXHRcdFx0XHR0aGlzLnNldFNlbGVjdGVkKGFjdGl2ZSk7XG5cdFx0XHRcdHRoaXMuaGlkZUxpc3Rib3goKTtcblx0XHRcdH1cblx0XHR9IGVsc2UgaWYgKFZLX0VTQyA9PT0gZS5rZXlDb2RlKSB7XG5cdFx0XHR0aGlzLmhpZGVMaXN0Ym94KCk7XG5cdFx0fVxuXHR9LFxuXG5cdHNldFNlbGVjdGVkOiBmdW5jdGlvbiAoZWwpIHtcblx0XHR0aGlzLnZhbHVlID0gZWwudGV4dENvbnRlbnQ7XG5cdFx0dXBkYXRlUmVzdGF1cmFudHMoKTtcblx0fSxcblxuXHQvKipcblx0ICogU2V0cyB0aGUgYXJpYS1hY3RpdmVkZXNjZW5kYW50IHZhbHVlIG9mIHRoZSB0ZXh0Ym94IHRvIHRoZSBJRCBvZiB0aGUgZ2l2ZW4gZWxlbWVudC5cblx0ICogQHBhcmFtIHtFbGVtZW50fSBlbFxuXHQgKi9cblx0c2V0QWN0aXZlRGVzY2VuZGFudDogZnVuY3Rpb24gKGVsKSB7XG5cdFx0aWYgKCFlbC5pZCkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHR0aGlzLmVsLnNldEF0dHJpYnV0ZSgnYXJpYS1hY3RpdmVkZXNjZW5kYW50JywgZWwuaWQpO1xuXHR9XG59O1xuXG4vKipcbiAqIEBjb25zdHJ1Y3RvclxuICogQHBhcmFtIHtFbGVtZW50fSBlbCBUaGUgZWxlbWVudCB0byBkZWNvcmF0ZSBhcyBhIGxpc3Rib3guXG4gKiBAcGFyYW0ge3RleHRib3h9IHRleHRib3ggVGhlIHRleHRib3ggd2hpY2ggY29udHJvbHMgdGhpcyBsaXN0Ym94IGluIGEgY29tYm9ib3ggcGF0dGVybi5cbiAqL1xuZnVuY3Rpb24gTGlzdEJveChlbCwgdGV4dGJveCkge1xuXHR0aGlzLmVsID0gZWw7XG5cdHRoaXMudGV4dGJveCA9IHRleHRib3g7XG5cdHRoaXMuaXRlbXMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChlbC5xdWVyeVNlbGVjdG9yQWxsKCdbcm9sZT1vcHRpb25dJykpO1xuXHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyBpKyspIHtcblx0XHRsZXQgaXRlbSA9IHRoaXMuaXRlbXNbaV07XG5cdFx0aXRlbS5pZCA9IG5leHRJZCgpO1xuXG5cdFx0aXRlbS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCB0aGlzLmhhbmRsZUhvdmVyT25JdGVtLmJpbmQodGhpcykpO1xuXHRcdGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5oYW5kbGVDbGlja09uSXRlbS5iaW5kKHRoaXMpLCB0cnVlKTtcblx0fVxuXG5cdHRoaXMudmlzaWJsZUl0ZW1zID0gdGhpcy5pdGVtcy5zbGljZSgpO1xufVxuXG5cbkxpc3RCb3gucHJvdG90eXBlID0ge1xuXHR0b2dnbGU6IGZ1bmN0aW9uICgpIHtcblx0XHRpZiAodGhpcy5oaWRkZW4pIHtcblx0XHRcdHRoaXMuc2hvdygpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLmhpZGUoKTtcblx0XHR9XG5cdH0sXG5cblx0Z2V0IGhpZGRlbigpIHtcblx0XHRyZXR1cm4gdGhpcy5lbC5oYXNBdHRyaWJ1dGUoJ2hpZGRlbicpO1xuXHR9LFxuXG5cdGdldCBhY3RpdmVJdGVtKCkge1xuXHRcdHJldHVybiB0aGlzLmVsLnF1ZXJ5U2VsZWN0b3IoJ1tyb2xlPW9wdGlvbl0uYWN0aXZlJyk7XG5cdH0sXG5cblx0ZmlsdGVyOiBmdW5jdGlvbiAoc3RyKSB7XG5cdFx0dGhpcy52aXNpYmxlSXRlbXMgPSBbXTtcblx0XHRsZXQgZm91bmRJdGVtcyA9IDA7XG5cdFx0Zm9yIChsZXQgaXRlbSBvZiB0aGlzLml0ZW1zKSB7XG5cdFx0XHRpZiAoaXRlbS50ZXh0Q29udGVudC50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoc3RyLnRvTG93ZXJDYXNlKCkpKSB7XG5cdFx0XHRcdGZvdW5kSXRlbXMrKztcblx0XHRcdFx0aXRlbS5oaWRkZW4gPSBmYWxzZTtcblx0XHRcdFx0dGhpcy52aXNpYmxlSXRlbXMucHVzaChpdGVtKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGl0ZW0uaGlkZGVuID0gdHJ1ZTtcblx0XHRcdFx0aXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKGZvdW5kSXRlbXMgPT09IDApIHtcblx0XHRcdHRoaXMuaGlkZSgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmlzaWJsZUl0ZW1zLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGxldCBpdGVtID0gdGhpcy52aXNpYmxlSXRlbXNbaV07XG5cdFx0XHRcdGl0ZW0uc2V0QXR0cmlidXRlKCdhcmlhLXBvc2luc2V0JywgaSArIDEpO1xuXHRcdFx0XHRpdGVtLnNldEF0dHJpYnV0ZSgnYXJpYS1zZXRzaXplJywgdGhpcy52aXNpYmxlSXRlbXMubGVuZ3RoKTtcblx0XHRcdH1cblx0XHR9XG5cdH0sXG5cblx0c2hvdzogZnVuY3Rpb24gKHRhcmdldCkge1xuXHRcdGlmICghdGhpcy5oaWRkZW4pXG5cdFx0XHRyZXR1cm47XG5cdFx0dGhpcy5lbC5zdHlsZS53aWR0aCA9IGAke3RhcmdldC5vZmZzZXRXaWR0aH1weGA7XG5cdFx0dGhpcy5lbC5zdHlsZS5sZWZ0ID0gYCR7dGFyZ2V0Lm9mZnNldExlZnR9cHhgO1xuXHRcdHRoaXMuZWwucmVtb3ZlQXR0cmlidXRlKCdoaWRkZW4nKTtcblx0fSxcblxuXHRoaWRlOiBmdW5jdGlvbiAoKSB7XG5cdFx0aWYgKHRoaXMuaGlkZGVuKVxuXHRcdFx0cmV0dXJuO1xuXG5cdFx0aWYgKHRoaXMuYWN0aXZlSXRlbSlcblx0XHRcdHRoaXMuYWN0aXZlSXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcblx0XHR0aGlzLmVsLnNldEF0dHJpYnV0ZSgnaGlkZGVuJywgJycpO1xuXHR9LFxuXG5cdGhhbmRsZUhvdmVyT25JdGVtOiBmdW5jdGlvbiAoZSkge1xuXHRcdGxldCBuZXdJZHggPSB0aGlzLnZpc2libGVJdGVtcy5pbmRleE9mKGUudGFyZ2V0KTtcblx0XHRpZiAobmV3SWR4IDwgMClcblx0XHRcdHJldHVybjtcblx0XHR0aGlzLmNoYW5nZUFjdGl2ZUxpc3RpdGVtKG5ld0lkeCk7XG5cdH0sXG5cblx0aGFuZGxlQ2xpY2tPbkl0ZW06IGZ1bmN0aW9uIChlKSB7XG5cdFx0bGV0IGl0ZW0gPSBlLnRhcmdldDtcblx0XHRpZiAodGhpcy5pdGVtcy5pbmRleE9mKGl0ZW0pIDwgMClcblx0XHRcdHJldHVybjtcblx0XHR0aGlzLnRleHRib3guc2V0U2VsZWN0ZWQoaXRlbSk7XG5cdFx0dGhpcy5oaWRlKCk7XG5cdH0sXG5cblx0bmV4dEFjdGl2ZUxpc3RJdGVtOiBmdW5jdGlvbiAoKSB7XG5cdFx0bGV0IGFjdGl2ZSA9IHRoaXMuYWN0aXZlSXRlbTtcblx0XHRsZXQgYWN0aXZlSWR4ID0gLTE7XG5cdFx0aWYgKGFjdGl2ZSlcblx0XHRcdGFjdGl2ZUlkeCA9IHRoaXMudmlzaWJsZUl0ZW1zLmluZGV4T2YoYWN0aXZlKTtcblxuXHRcdGxldCBuZXdJZHggPSBhY3RpdmVJZHg7XG5cdFx0bmV3SWR4ID0gKG5ld0lkeCArIDEpICUgdGhpcy52aXNpYmxlSXRlbXMubGVuZ3RoO1xuXHRcdHRoaXMuY2hhbmdlQWN0aXZlTGlzdGl0ZW0obmV3SWR4KTtcblx0fSxcblxuXHRwcmV2aW91c0FjdGl2ZUxpc3RJdGVtOiBmdW5jdGlvbiAoKSB7XG5cdFx0bGV0IGFjdGl2ZSA9IHRoaXMuYWN0aXZlSXRlbTtcblx0XHRsZXQgYWN0aXZlSWR4ID0gLTE7XG5cdFx0aWYgKGFjdGl2ZSlcblx0XHRcdGFjdGl2ZUlkeCA9IHRoaXMudmlzaWJsZUl0ZW1zLmluZGV4T2YoYWN0aXZlKTtcblxuXHRcdGxldCBuZXdJZHggPSBhY3RpdmVJZHg7XG5cdFx0bmV3SWR4LS07XG5cdFx0aWYgKG5ld0lkeCA8IDApXG5cdFx0XHRuZXdJZHggKz0gdGhpcy52aXNpYmxlSXRlbXMubGVuZ3RoO1xuXG5cdFx0dGhpcy5jaGFuZ2VBY3RpdmVMaXN0aXRlbShuZXdJZHgpO1xuXHR9LFxuXG5cdGNoYW5nZUFjdGl2ZUxpc3RpdGVtOiBmdW5jdGlvbiAobmV3SWR4KSB7XG5cdFx0bGV0IGFjdGl2ZSA9IHRoaXMuYWN0aXZlSXRlbTtcblx0XHRsZXQgbmV3QWN0aXZlID0gdGhpcy52aXNpYmxlSXRlbXNbbmV3SWR4XTtcblx0XHRpZiAoYWN0aXZlKVxuXHRcdFx0YWN0aXZlLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuXHRcdG5ld0FjdGl2ZS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcblxuXHRcdHRoaXMudGV4dGJveC5zZXRBY3RpdmVEZXNjZW5kYW50KG5ld0FjdGl2ZSk7XG5cdH1cbn07Il19
